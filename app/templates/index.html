<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACOS Forecast Calculator - Nowoczesny kalkulator rentowności kampanii</title>
    <meta name="description" content="Profesjonalny kalkulator ACOS do analizy rentowności kampanii reklamowych z integracją NBP API i przeliczaniem w czasie rzeczywistym">
    <meta name="keywords" content="ACOS, kalkulator, rentowność, kampanie reklamowe, ROI, Amazon, PPC">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📊</text></svg>">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-logo">
                <img src="https://amzteam.pro/wp-content/uploads/2024/01/AMZ-LOGO-EBISU.svg" alt="AmzTeam.pro Logo" class="logo">
            </div>
            <div class="header-content">
                <h1>ACOS Forecast Calculator</h1>
                <p>Profesjonalny kalkulator prognoz rentowności kampanii reklamowych</p>
            </div>
        </header>

        <!-- Komunikaty błędów i sukcesów -->
        {% if error %}
        <div class="alert alert-error">
            <strong>Błąd:</strong> {{ error }}
        </div>
        {% endif %}

        {% if success %}
        <div class="alert alert-success">
            <strong>Sukces:</strong> {{ success }}
        </div>
        {% endif %}

        <!-- Wybór metody wprowadzania danych -->
        <section class="input-method-section">
            <h2>1. Metoda wprowadzania danych</h2>
            <p>Wybierz sposób wprowadzenia danych do kalkulatora ACOS</p>
            <div class="method-selector">
                <article class="method-option" id="manual-method">
                    <div class="method-icon">⚙️</div>
                    <h3>Manual Inputs</h3>
                    <p>Wprowadź docelowe wskaźniki kampanii używając interaktywnych suwaków i pól numerycznych</p>
                    <button type="button" class="btn btn-primary" onclick="selectMethod('manual')">Wybierz metodę</button>
                </article>
                <article class="method-option" id="budget-method">
                    <div class="method-icon">💰</div>
                    <h3>Budget Calculator</h3>
                    <p>Oblicz budżet marketingowy na podstawie zakładanego TACOS i docelowej sprzedaży</p>
                    <button type="button" class="btn btn-success" id="open-budget-calc">Wybierz metodę</button>
                </article>
                <article class="method-option" id="upload-method">
                    <div class="method-icon">📤</div>
                    <h3>Bulk Operations Upload</h3>
                    <p>Prześlij raport z danymi kampanii aby automatycznie wypełnić metryki prognozy</p>
                    <button type="button" class="btn btn-secondary" onclick="selectMethod('upload')">Wybierz metodę</button>
                </article>
            </div>
        </section>

        <!-- Formularz z suwakami dla zaawansowanych metryk -->
        <section class="form-section forecast-variables-section" id="forecast-form" style="display: none;">
            <h2>2. Zmienne prognozy</h2>
            <p>Wprowadź docelowe wskaźniki kampanii ręcznie lub użyj interaktywnych suwaków aby dostosować wartości. Wyniki przeliczają się automatycznie w czasie rzeczywistym.</p>
            
            <form method="POST" action="/calculate-forecast" class="forecast-form">
                <div class="variables-grid">
                    <!-- Marża brutto -->
                    <div class="variable-item">
                        <label for="gross_margin">Marża brutto (%)</label>
                        <div class="slider-container">
                            <input type="range" id="gross_margin_slider" min="0" max="100" step="0.1" 
                                   value="{{ gross_margin if gross_margin else '30' }}" 
                                   oninput="updateSliderValue('gross_margin', this.value)">
                            <input type="number" id="gross_margin" name="gross_margin" step="0.1" min="0" max="100" 
                                   value="{{ gross_margin if gross_margin else '30' }}" 
                                   onchange="updateSliderFromInput('gross_margin', this.value)" required>
                        </div>
                        <small>Marża zysku produktu przed kosztami reklamy</small>
                    </div>

                    <!-- Target AOV -->
                    <div class="variable-item">
                        <label for="target_aov">Docelowa wartość zamówienia (EUR)</label>
                        <div class="slider-container">
                            <input type="range" id="target_aov_slider" min="5" max="500" step="0.1" 
                                   value="{{ target_aov if target_aov else '25' }}" 
                                   oninput="updateSliderValue('target_aov', this.value)">
                            <input type="number" id="target_aov" name="target_aov" step="0.1" min="5" max="500" 
                                   value="{{ target_aov if target_aov else '25' }}" 
                                   onchange="updateSliderFromInput('target_aov', this.value)" required>
                        </div>
                        <small>Oczekiwana średnia wartość zamówienia w EUR</small>
                    </div>

                    <!-- Target CTR -->
                    <div class="variable-item">
                        <label for="target_ctr">Docelowy CTR (%)</label>
                        <div class="slider-container">
                            <input type="range" id="target_ctr_slider" min="0.1" max="20" step="0.1" 
                                   value="{{ target_ctr if target_ctr else '3' }}" 
                                   oninput="updateSliderValue('target_ctr', this.value)">
                            <input type="number" id="target_ctr" name="target_ctr" step="0.1" min="0.1" max="20" 
                                   value="{{ target_ctr if target_ctr else '3' }}" 
                                   onchange="updateSliderFromInput('target_ctr', this.value)" required>
                        </div>
                        <small>Oczekiwany współczynnik klikalności</small>
                    </div>

                    <!-- Target CPC -->
                    <div class="variable-item">
                        <label for="target_cpc">Docelowy CPC (EUR)</label>
                        <div class="slider-container">
                            <input type="range" id="target_cpc_slider" min="0.1" max="20" step="0.1" 
                                   value="{{ target_cpc if target_cpc else '1' }}" 
                                   oninput="updateSliderValue('target_cpc', this.value)">
                            <input type="number" id="target_cpc" name="target_cpc" step="0.1" min="0.1" max="20" 
                                   value="{{ target_cpc if target_cpc else '1' }}" 
                                   onchange="updateSliderFromInput('target_cpc', this.value)" required>
                        </div>
                        <small>Oczekiwany koszt za kliknięcie w EUR (Bid)</small>
                    </div>

                    <!-- Target CVR -->
                    <div class="variable-item">
                        <label for="target_cvr">Docelowy CVR (%)</label>
                        <div class="slider-container">
                            <input type="range" id="target_cvr_slider" min="0.1" max="30" step="0.1" 
                                   value="{{ target_cvr if target_cvr else '3' }}" 
                                   oninput="updateSliderValue('target_cvr', this.value)">
                            <input type="number" id="target_cvr" name="target_cvr" step="0.1" min="0.1" max="30" 
                                   value="{{ target_cvr if target_cvr else '3' }}" 
                                   onchange="updateSliderFromInput('target_cvr', this.value)" required>
                        </div>
                        <small>Oczekiwany współczynnik konwersji</small>
                    </div>

                    <!-- Impressions -->
                    <div class="variable-item">
                        <label for="impressions">Wyświetlenia</label>
                        <div class="slider-container">
                            <input type="range" id="impressions_slider" min="100" max="100000" step="100" 
                                   value="{{ impressions if impressions else '1000' }}" 
                                   oninput="updateSliderValue('impressions', this.value)">
                            <input type="number" id="impressions" name="impressions" step="100" min="100" max="100000" 
                                   value="{{ impressions if impressions else '1000' }}" 
                                   onchange="updateSliderFromInput('impressions', this.value)" required>
                        </div>
                        <small>Oczekiwana liczba wyświetleń reklamy</small>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Oblicz prognozę</button>
            </form>
        </section>

        <!-- Prosty formularz do obliczeń (ukryty domyślnie) -->
        <section class="form-section" id="simple-form" style="display: none;">
            <h2>Wprowadź dane kampanii</h2>
            <form method="POST" action="/calculate" class="calculation-form">
                <div class="form-group">
                    <label for="sales">Prognozowana sprzedaż (PLN)</label>
                    <input type="number" id="sales" name="sales" step="0.01" min="0" 
                           value="{{ sales if sales else '' }}" 
                           placeholder="np. 10000.00" required>
                </div>

                <div class="form-group">
                    <label for="spend">Prognozowane wydatki na reklamę (PLN)</label>
                    <input type="number" id="spend" name="spend" step="0.01" min="0" 
                           value="{{ spend if spend else '' }}" 
                           placeholder="np. 2000.00" required>
                </div>

                <div class="form-group">
                    <label for="margin">Marża brutto (%)</label>
                    <input type="number" id="margin" name="margin" step="0.01" min="0" max="100" 
                           value="{{ margin if margin else '' }}" 
                           placeholder="np. 25.00" required>
                </div>

                <button type="submit" class="btn btn-primary">Oblicz ACOS</button>
            </form>
        </section>

        <!-- Formularz do obliczania budżetu z TACOS -->
        <section class="form-section budget-calculator-section" id="budget-form" style="display: none;">
            <h2>2. Kalkulator budżetu marketingowego</h2>
            <p>Oblicz optymalny budżet marketingowy na podstawie zakładanego TACOS i docelowej sprzedaży. TACOS to stosunek wydatków na marketing do wartości sprzedaży.</p>
            
            <form method="POST" action="/calculate-budget" class="budget-form">
                <div class="variables-grid">
                    <!-- Docelowa sprzedaż -->
                    <div class="variable-item">
                        <label for="target_sales">Docelowa wartość sprzedaży (EUR)</label>
                        <div class="slider-container">
                            <input type="range" id="target_sales_slider" min="1000" max="100000" step="100" 
                                   value="{{ target_sales if target_sales else '10000' }}" 
                                   oninput="updateSliderValue('target_sales', this.value)">
                            <input type="number" id="target_sales" name="target_sales" step="100" min="1000" max="100000" 
                                   value="{{ target_sales if target_sales else '10000' }}" 
                                   onchange="updateSliderFromInput('target_sales', this.value)" required>
                        </div>
                        <small>Oczekiwana wartość sprzedaży w EUR</small>
                    </div>

                    <!-- Zakładany TACOS -->
                    <div class="variable-item">
                        <label for="target_tacos">Zakładany TACOS (%)</label>
                        <div class="slider-container">
                            <input type="range" id="target_tacos_slider" min="5" max="50" step="0.5" 
                                   value="{{ target_tacos if target_tacos else '15' }}" 
                                   oninput="updateSliderValue('target_tacos', this.value)">
                            <input type="number" id="target_tacos" name="target_tacos" step="0.5" min="5" max="50" 
                                   value="{{ target_tacos if target_tacos else '15' }}" 
                                   onchange="updateSliderFromInput('target_tacos', this.value)" required>
                        </div>
                        <small>Zakładany stosunek wydatków marketingowych do sprzedaży</small>
                    </div>

                    <!-- Marża brutto -->
                    <div class="variable-item">
                        <label for="budget_gross_margin">Marża brutto (%)</label>
                        <div class="slider-container">
                            <input type="range" id="budget_gross_margin_slider" min="10" max="80" step="1" 
                                   value="{{ gross_margin if gross_margin else '30' }}" 
                                   oninput="updateSliderValue('budget_gross_margin', this.value)">
                            <input type="number" id="budget_gross_margin" name="gross_margin" step="1" min="10" max="80" 
                                   value="{{ gross_margin if gross_margin else '30' }}" 
                                   onchange="updateSliderFromInput('budget_gross_margin', this.value)" required>
                        </div>
                        <small>Marża zysku produktu przed kosztami marketingowymi</small>
                    </div>
                </div>

                <button type="submit" class="btn btn-success">Oblicz budżet marketingowy</button>
            </form>
        </section>

        <!-- Upload pliku -->
        <section class="form-section">
            <h2>Import danych z pliku</h2>
            <form method="POST" action="/upload" enctype="multipart/form-data" class="upload-form">
                <div class="form-group">
                    <label for="file">Przesłij plik CSV z danymi</label>
                    <input type="file" id="file" name="file" accept=".csv" required>
                    <small class="form-text">Dozwolone formaty: CSV</small>
                </div>
                <button type="submit" class="btn btn-secondary">Prześlij plik</button>
            </form>
        </section>

        <!-- Wyniki obliczeń -->
        {% if results %}
        <section class="results-section">
            <h2>Wyniki analizy</h2>
            
            <!-- Komunikat o rentowności -->
            {% if results.profitability_message %}
            <div class="alert {{ 'alert-success' if results.is_profitable else 'alert-error' }}">
                {{ results.profitability_message }}
            </div>
            {% endif %}

            {% if results and budget_mode %}
            <!-- Budget Results - wyniki kalkulatora budżetu -->
            <div class="budget-results-header">
                <h2>3. Wyniki kalkulatora budżetu</h2>
                {% if results.currency_info %}
                <div class="currency-info">
                    <small>💱 {{ results.currency_info }}</small>
                </div>
                {% endif %}
            </div>

            <div class="budget-grid">
                <!-- Górny rząd - główne wyniki -->
                <div class="metric-card target-sales">
                    <h3>Docelowa sprzedaż</h3>
                    <div class="metric-value blue">
                        €{{ results.target_sales|int }}
                    </div>
                    <div class="metric-pln">{{ results.target_sales_pln|int }} PLN</div>
                    <div class="metric-icon">📈</div>
                </div>

                <div class="metric-card marketing-budget">
                    <h3>Budżet marketingowy</h3>
                    <div class="metric-value red">
                        €{{ results.marketing_budget|int }}
                    </div>
                    <div class="metric-pln">{{ results.marketing_budget_pln|int }} PLN</div>
                    <div class="metric-icon">💰</div>
                </div>

                <!-- Drugi rząd -->
                <div class="metric-card target-tacos">
                    <h3>Zakładany TACOS</h3>
                    <div class="metric-value neutral">
                        {{ results.target_tacos }}%
                    </div>
                    <div class="metric-icon">🎯</div>
                </div>

                <div class="metric-card roi">
                    <h3>ROI</h3>
                    <div class="metric-value {{ 'profitable' if results.roi > 0 else 'unprofitable' }}">
                        {{ results.roi }}%
                    </div>
                    <div class="metric-icon">📊</div>
                </div>

                <!-- Trzeci rząd -->
                <div class="metric-card gross-profit">
                    <h3>Zysk brutto</h3>
                    <div class="metric-value profitable">
                        €{{ results.gross_profit|int }}
                    </div>
                    <div class="metric-pln">{{ results.gross_profit_pln|int }} PLN</div>
                    <div class="metric-icon">💸</div>
                </div>

                <div class="metric-card net-profit">
                    <h3>Zysk netto</h3>
                    <div class="metric-value {{ 'profitable' if results.net_profit > 0 else 'unprofitable' }}">
                        €{{ results.net_profit|int }}
                    </div>
                    <div class="metric-pln">{{ results.net_profit_pln|int }} PLN</div>
                    <div class="metric-icon">💵</div>
                </div>

                <!-- Czwarty rząd - dodatkowe metryki -->
                <div class="metric-card profit-margin">
                    <h3>Marża zysku</h3>
                    <div class="metric-value {{ 'profitable' if results.profit_margin > 0 else 'unprofitable' }}">
                        {{ results.profit_margin }}%
                    </div>
                </div>

                <div class="metric-card marketing-ratio">
                    <h3>Stosunek marketing/zysk</h3>
                    <div class="metric-value neutral">
                        {{ results.marketing_to_profit_ratio }}%
                    </div>
                </div>
            </div>

            <!-- Ostrzeżenie o nierentowności -->
            {% if not results.is_profitable %}
            <div class="unprofitable-warning">
                <div class="warning-icon">⚠️</div>
                <div class="warning-content">
                    <h3>Nierentowna kampania</h3>
                    <p>{{ results.profitability_message }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Podsumowanie budżetu -->
            <div class="summary-section">
                <h3>Podsumowanie budżetu</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="label">Docelowa sprzedaż:</span>
                        <span class="value">€{{ results.target_sales|int }}<small> ({{ results.target_sales_pln|int }} PLN)</small></span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Budżet marketingowy:</span>
                        <span class="value">€{{ results.marketing_budget|int }}<small> ({{ results.marketing_budget_pln|int }} PLN)</small></span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Zakładany TACOS:</span>
                        <span class="value">{{ results.target_tacos }}%</span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Zysk netto:</span>
                        <span class="value">€{{ results.net_profit|int }}<small> ({{ results.net_profit_pln|int }} PLN)</small></span>
                    </div>
                </div>
            </div>
            {% endif %}

            {% if results and forecast_mode %}
            <!-- Forecast Results - główne metryki zgodnie ze screenshotem -->
            <div class="forecast-results-header">
                <h2>3. Forecast Results</h2>
                {% if results.currency_info %}
                <div class="currency-info">
                    <small>💱 {{ results.currency_info }}</small>
                </div>
                {% endif %}
            </div>

            <div class="forecast-grid">
                <!-- Górny rząd - główne wyniki -->
                <div class="metric-card projected-sales">
                    <h3>Projected Sales</h3>
                    <div class="metric-value blue">
                        €{{ results.projected_sales|int }}
                    </div>
                    <div class="metric-pln">{{ results.projected_sales_pln|int }} PLN</div>
                    <div class="metric-icon">📈</div>
                </div>

                <div class="metric-card projected-spend">
                    <h3>Projected Spend</h3>
                    <div class="metric-value red">
                        €{{ results.projected_spend|int }}
                    </div>
                    <div class="metric-pln">{{ results.projected_spend_pln|int }} PLN</div>
                    <div class="metric-icon">💰</div>
                </div>

                <!-- Drugi rząd -->
                <div class="metric-card expected-acos">
                    <h3>Expected ACOS</h3>
                    <div class="metric-value {{ 'profitable' if results.is_profitable else 'unprofitable' }}">
                        {{ results.acos|int }}%
                    </div>
                    <div class="metric-icon">🎯</div>
                </div>

                <div class="metric-card roi">
                    <h3>ROI</h3>
                    <div class="metric-value {{ 'profitable' if results.roi > 0 else 'unprofitable' }}">
                        {{ results.roi|int }}%
                    </div>
                    <div class="metric-icon">📊</div>
                </div>

                <!-- Trzeci rząd -->
                <div class="metric-card profit-per-sale">
                    <h3>Profit per Sale</h3>
                    <div class="metric-value {{ 'profitable' if results.profit_per_sale > 0 else 'unprofitable' }}">
                        €{{ results.profit_per_sale|int }}
                    </div>
                    <div class="metric-pln">{{ results.profit_per_sale_pln|int }} PLN</div>
                    <div class="metric-icon">💸</div>
                </div>

                <div class="metric-card total-profit">
                    <h3>Total Profit</h3>
                    <div class="metric-value {{ 'profitable' if results.profit > 0 else 'unprofitable' }}">
                        €{{ results.profit|int }}
                    </div>
                    <div class="metric-pln">{{ results.profit_pln|int }} PLN</div>
                    <div class="metric-icon">💵</div>
                </div>

                <!-- Czwarty rząd - dodatkowe metryki -->
                <div class="metric-card projected-clicks">
                    <h3>Projected Clicks</h3>
                    <div class="metric-value neutral">
                        {{ results.clicks|int }}
                    </div>
                </div>

                <div class="metric-card projected-orders">
                    <h3>Projected Orders</h3>
                    <div class="metric-value neutral">
                        {{ results.orders|int }}
                    </div>
                </div>

                <!-- Piąty rząd -->
                <div class="metric-card projected-spend-alt">
                    <h3>Projected Spend</h3>
                    <div class="metric-value neutral">
                        €{{ results.projected_spend|int }}
                    </div>
                    <div class="metric-pln">{{ results.projected_spend_pln|int }} PLN</div>
                </div>

                <div class="metric-card break-even-acos">
                    <h3>Break-even ACOS</h3>
                    <div class="metric-value neutral">
                        {{ results.break_even_acos|int }}%
                    </div>
                </div>
            </div>

            <!-- Ostrzeżenie o nierentowności jak na screenshocie -->
            {% if not results.is_profitable %}
            <div class="unprofitable-warning">
                <div class="warning-icon">⚠️</div>
                <div class="warning-content">
                    <h3>Nierentowna kampania</h3>
                    <p>{{ results.profitability_message }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Przycisk eksportu wyników -->
            <div class="export-section">
                <h3>Eksport wyników do planowania budżetu</h3>
                <form method="POST" action="/export-results" class="export-form">
                    <input type="hidden" name="gross_margin" value="{{ gross_margin }}">
                    <input type="hidden" name="target_aov" value="{{ target_aov }}">
                    <input type="hidden" name="target_ctr" value="{{ target_ctr }}">
                    <input type="hidden" name="target_cpc" value="{{ target_cpc }}">
                    <input type="hidden" name="target_cvr" value="{{ target_cvr }}">
                    <input type="hidden" name="impressions" value="{{ impressions }}">
                    <button type="submit" class="btn btn-export">
                        📊 Pobierz raport Excel
                    </button>
                </form>
            </div>

            <!-- Podsumowanie -->
            <div class="summary-section">
                <h3>Podsumowanie</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <span class="label">Prognozowana sprzedaż:</span>
                        <span class="value">€{{ results.projected_sales|int }}<small> ({{ results.projected_sales_pln|int }} PLN)</small></span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Wydatki na reklamę:</span>
                        <span class="value">€{{ results.projected_spend|int }}<small> ({{ results.projected_spend_pln|int }} PLN)</small></span>
                    </div>
                    <div class="summary-item">
                        <span class="label">Marża brutto:</span>
                        <span class="value">{{ results.gross_margin }}%</span>
                    </div>
                </div>
            </div>
            {% endif %}
        </section>
        {% endif %}

        <!-- Informacje o narzędziu -->
        <section class="info-section">
            <h2>📊 ACOS Forecast Calculator</h2>
            <div class="tool-description">
                <h3>🎯 Co robi to narzędzie?</h3>
                <p>Oblicza i prognozuje Advertising Cost of Sale (ACOS) aby zoptymalizować rentowność kampanii i alokację budżetu. Przewiduje ACOS na podstawie metryk CTR, CVR, AOV i CPC z szczegółową analizą zysku w czasie rzeczywistym.</p>
                
                <h3>⚡ Kluczowe funkcje:</h3>
                <ul>
                    <li><strong>Prognozowanie ACOS:</strong> Przewiduje koszt reklamy względem sprzedaży na podstawie metryk wydajności</li>
                    <li><strong>Analiza zysku:</strong> Oblicza oczekiwany zysk na sprzedaż po kosztach reklamy</li>
                    <li><strong>Ustawianie celów:</strong> Optymalizuje CTR, CVR, AOV i CPC dla rentowności</li>
                    <li><strong>Planowanie budżetu:</strong> Planuje wydatki na reklamę na podstawie oczekiwanej wydajności</li>
                    <li><strong>Przeliczanie w czasie rzeczywistym:</strong> Automatyczne aktualizowanie wyników przy zmianie parametrów</li>
                    <li><strong>Integracja z NBP:</strong> Aktualny kurs EUR/PLN z Narodowego Banku Polskiego</li>
                </ul>

                <h3>🚀 Jak używać tego narzędzia:</h3>
                <ol>
                    <li>Wybierz metodę wprowadzania danych: prześlij plik operacji hurtowych lub użyj ręcznych danych</li>
                    <li>Ustaw zmienne: skonfiguruj marżę brutto, CTR, CVR, AOV i cele CPC używając suwaków</li>
                    <li>Przejrzyj prognozę: analizuj oczekiwane projekcje ACOS i zysku w czasie rzeczywistym</li>
                    <li>Dostosuj cele: dostrajaj metryki aby zoptymalizować rentowność</li>
                    <li>Eksportuj wyniki: pobierz profesjonalny raport Excel do planowania budżetu</li>
                </ol>

                <h3>🔬 Formuła ACOS:</h3>
                <div class="formula-box">
                    <p><strong>ACOS = Ad Spend / Ad Sales</strong></p>
                    <p><strong>ACOS = (Bid × Clicks) / [(Impressions × CTR%) × CVR% × AOV]</strong></p>
                    <small>Zbalansuj koszty reklamy z marżami zysku używając szczegółowych metryk wydajności.</small>
                </div>
            </div>
        </section>
    </div>

    <script>
        // Funkcja do wyboru metody wprowadzania danych
        function selectMethod(method) {
            const forecastForm = document.getElementById('forecast-form');
            const simpleForm = document.getElementById('simple-form');
            const budgetForm = document.getElementById('budget-form');
            const uploadSection = document.querySelector('.upload-form').parentElement;
            
            // Ukryj wszystkie formularze
            forecastForm.style.display = 'none';
            simpleForm.style.display = 'none';
            budgetForm.style.display = 'none';
            uploadSection.style.display = 'none';
            
            // Usuń podświetlenie ze wszystkich opcji
            document.getElementById('manual-method').classList.remove('selected');
            document.getElementById('budget-method').classList.remove('selected');
            document.getElementById('upload-method').classList.remove('selected');
            
            if (method === 'manual') {
                forecastForm.style.display = 'block';
                document.getElementById('manual-method').classList.add('selected');
            } else if (method === 'budget') {
                budgetForm.style.display = 'block';
                document.getElementById('budget-method').classList.add('selected');
            } else if (method === 'upload') {
                uploadSection.style.display = 'block';
                document.getElementById('upload-method').classList.add('selected');
            }
        }

        // Funkcja do aktualizacji wartości pola liczbowego na podstawie suwaka
        function updateSliderValue(fieldName, value) {
            const numberInput = document.getElementById(fieldName);
            const slider = document.getElementById(fieldName + '_slider');
            
            numberInput.value = value;
            
            // Aktualizacja koloru suwaka na podstawie wartości
            updateSliderColor(slider, value);
            
            // Automatyczne przeliczenie w czasie rzeczywistym z debouncing
            clearTimeout(window.calculateTimeout);
            window.calculateTimeout = setTimeout(calculateRealTime, 300);
        }

        // Funkcja do aktualizacji suwaka na podstawie pola liczbowego
        function updateSliderFromInput(fieldName, value) {
            const slider = document.getElementById(fieldName + '_slider');
            const numberInput = document.getElementById(fieldName);
            
            // Walidacja zakresu
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const numValue = parseFloat(value);
            
            if (numValue >= min && numValue <= max) {
                slider.value = value;
                updateSliderColor(slider, value);
                
                // Automatyczne przeliczenie w czasie rzeczywistym z debouncing
                clearTimeout(window.calculateTimeout);
                window.calculateTimeout = setTimeout(calculateRealTime, 300);
            } else {
                // Przywrócenie poprzedniej wartości jeśli poza zakresem
                numberInput.value = slider.value;
                alert(`Wartość musi być między ${min} a ${max}`);
            }
        }

        // Funkcja do przeliczania w czasie rzeczywistym
        async function calculateRealTime() {
            // Pobieranie wartości z formularza
            const gross_margin = document.getElementById('gross_margin').value;
            const target_aov = document.getElementById('target_aov').value;
            const target_ctr = document.getElementById('target_ctr').value;
            const target_cpc = document.getElementById('target_cpc').value;
            const target_cvr = document.getElementById('target_cvr').value;
            const impressions = document.getElementById('impressions').value;
            
            // Sprawdzenie czy wszystkie pola są wypełnione
            if (!gross_margin || !target_aov || !target_ctr || !target_cpc || !target_cvr || !impressions) {
                return;
            }
            
            // Pokazanie wskaźnika ładowania
            showLoadingIndicator();
            
            try {
                // Przygotowanie danych do wysłania
                const formData = new FormData();
                formData.append('gross_margin', gross_margin);
                formData.append('target_aov', target_aov);
                formData.append('target_ctr', target_ctr);
                formData.append('target_cpc', target_cpc);
                formData.append('target_cvr', target_cvr);
                formData.append('impressions', impressions);
                
                // Wysłanie zapytania do API
                const response = await fetch('/calculate-forecast', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const html = await response.text();
                    updateResultsSection(html);
                } else {
                    console.error('Błąd podczas obliczania:', response.statusText);
                }
            } catch (error) {
                console.error('Błąd podczas obliczania:', error);
            } finally {
                hideLoadingIndicator();
            }
        }

        // Funkcja do wyświetlania wskaźnika ładowania
        function showLoadingIndicator() {
            let loadingDiv = document.getElementById('loading-indicator');
            if (!loadingDiv) {
                loadingDiv = document.createElement('div');
                loadingDiv.id = 'loading-indicator';
                loadingDiv.innerHTML = '<div class="loading-spinner">🔄 Obliczanie...</div>';
                loadingDiv.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(255, 255, 255, 0.95);
                    padding: 20px;
                    border-radius: 10px;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                    z-index: 1000;
                    font-size: 16px;
                    font-weight: bold;
                `;
                document.body.appendChild(loadingDiv);
            }
            loadingDiv.style.display = 'block';
        }

        // Funkcja do ukrywania wskaźnika ładowania
        function hideLoadingIndicator() {
            const loadingDiv = document.getElementById('loading-indicator');
            if (loadingDiv) {
                loadingDiv.style.display = 'none';
            }
        }

        // Funkcja do aktualizacji sekcji wyników
        function updateResultsSection(html) {
            // Parsowanie HTML odpowiedzi
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // Znalezienie sekcji wyników w nowym HTML
            const newResultsSection = doc.querySelector('.results-section');
            
            if (newResultsSection) {
                // Usunięcie starej sekcji wyników jeśli istnieje
                const oldResultsSection = document.querySelector('.results-section');
                if (oldResultsSection) {
                    oldResultsSection.remove();
                }
                
                // Dodanie nowej sekcji wyników
                const forecastForm = document.querySelector('.forecast-form');
                if (forecastForm) {
                    forecastForm.parentElement.insertAdjacentElement('afterend', newResultsSection);
                }
                
                // Ponowne dodanie efektów hover do kart metryk
                addHoverEffectsToMetricCards();
            }
        }

        // Funkcja do dodawania efektów hover do kart metryk
        function addHoverEffectsToMetricCards() {
            const metricCards = document.querySelectorAll('.metric-card');
            metricCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px) scale(1.02)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
        }

        // Funkcja do aktualizacji koloru suwaka
        function updateSliderColor(slider, value) {
            const min = parseFloat(slider.min);
            const max = parseFloat(slider.max);
            const percentage = ((value - min) / (max - min)) * 100;
            
            slider.style.background = `linear-gradient(to right, #667eea 0%, #667eea ${percentage}%, #ddd ${percentage}%, #ddd 100%)`;
        }

        // Inicjalizacja wszystkich elementów przy ładowaniu strony
        document.addEventListener('DOMContentLoaded', function() {
            // Inicjalizacja suwaków
            const sliders = document.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                updateSliderColor(slider, slider.value);
                
                // Dodanie nasłuchiwania na zmianę wartości
                slider.addEventListener('input', function() {
                    updateSliderColor(this, this.value);
                });
            });
            
            // Dodanie event listenerów do pól input dla automatycznego przeliczania
            const inputFields = ['gross_margin', 'target_aov', 'target_ctr', 'target_cpc', 'target_cvr', 'impressions'];
            inputFields.forEach(fieldName => {
                const inputField = document.getElementById(fieldName);
                if (inputField) {
                    inputField.addEventListener('input', function() {
                        // Debouncing - opóźnienie wykonania aby uniknąć zbyt częstych wywołań
                        clearTimeout(window.calculateTimeout);
                        window.calculateTimeout = setTimeout(calculateRealTime, 500);
                    });
                }
            });
            
            // Ukrycie przycisku "Oblicz prognozę" i zmiana na informacyjny tekst
            const submitButton = document.querySelector('.forecast-form button[type="submit"]');
            if (submitButton) {
                submitButton.style.display = 'none';
                
                // Dodanie informacji o automatycznym przeliczaniu
                const infoDiv = document.createElement('div');
                infoDiv.className = 'real-time-info';
                infoDiv.innerHTML = `
                    <div style="
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        padding: 15px;
                        border-radius: 10px;
                        text-align: center;
                        margin-top: 20px;
                        font-weight: bold;
                        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                    ">
                        ⚡ Wyniki przeliczają się automatycznie w czasie rzeczywistym!
                    </div>
                `;
                submitButton.parentElement.appendChild(infoDiv);
            }
            
            // Domyślne wyświetlenie metody manual
            selectMethod('manual');
            
            // Dodanie efektów hover do istniejących kart metryk
            addHoverEffectsToMetricCards();
            
            // Automatyczne przeliczenie przy pierwszym załadowaniu strony
            setTimeout(calculateRealTime, 1000);

            // Otwieranie kalkulatora budżetu w nowym oknie
            const budgetBtn = document.getElementById('open-budget-calc');
            if (budgetBtn) {
                budgetBtn.addEventListener('click', function(e) {
                    window.open('/budget', '_blank', 'width=900,height=900');
                });
            }
        });

        // Funkcja do formatowania liczb w czasie rzeczywistym
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }
    </script>

    <footer>
        <div class="footer-content">
            <div class="footer-branding">
                <span class="footer-brand">By Amzteam.pro</span>
                <span class="footer-creator">Stworzył: Bartek z Twoje Drzwi do Amazon</span>
                <span class="footer-tech">Powered by Cursor AI</span>
            </div>
            <div class="footer-copyright">
                <span>© 2025 ACOS Forecast Calculator. Profesjonalny kalkulator analizy rentowności kampanii reklamowych z integracją NBP API.</span>
            </div>
        </div>
    </footer>
</body>
</html> 